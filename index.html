<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>

  <!-- Create the canvas that the C++ code will draw into -->
  <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
  <div id="prompt">
  </div>
  <div id="buttons">
  </div>

  <!-- Allow the C++ to access the canvas element --> 
  <script type='text/javascript'>
    var canv = document.getElementById('canvas');
    var Module = {
      canvas: canv
    };
  </script>
  
  <!-- Call the javascript glue code as generated by Emscripten -->
  <script src="main.js"></script>

  <!-- Allow the javascript to call C++ functions -->
  <script type='text/javascript'>
    function onClick (e) {
      Module.ccall('handle_input', null, ['string'], [e.target.getAttribute("data-key")]);
    }
    function onReceiveData (data) {
      // update the prompt value
      document.getElementById("prompt").innerHTML = data['prompt'];

      // update the button values
      let parent = document.getElementById("buttons");
      while (parent.firstChild) {
        parent.removeChild(parent.firstChild);
      }

      for (let button of data['buttons']) {
        let new_button = document.createElement ('button');
        new_button.innerHTML = button['txt'];
        new_button.dataset.key = button['key'];
        new_button.addEventListener('click', onClick, false);
        parent.appendChild (new_button);
      }
    }
    function onEngineReady () {
      Module.ccall('handle_input', null, ['string'], ["empty"]);
    }
  </script>

</body>

</html>
